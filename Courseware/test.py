context = {'Date': '29 May 2025', 'Year': 2025, 'Name_of_Organisation': 'Tertiary Infotech Pte Ltd', 'Course_Title': 'Improve Hiring Decisions with GenAI Assisted Interview Questioning', 'TSC_Title': 'Interviewing', 'TSC_Code': 'RET-PMD-4003-1.1', 'Total_Training_Hours': '7 hrs', 'Total_Assessment_Hours': '1 hr', 'Total_Course_Duration_Hours': '8 hrs', 'Learning_Units': [{'LU_Title': 'LU1: Interview Preparation for HR Professionals', 'LU_Duration': '2.5 hrs', 'Topics': [{'Topic_Title': 'Topic 1: Interview Preparation for HR Professionals (K3, K4, A1)', 'Bullet_Points': ['Understanding the Purpose and Objectives of the Interview', 'Legal, Ethical, and Socio-Cultural Considerations in Interviewing', 'Designing Effective Interview Structures', 'Preparing Appropriate and Targeted Interview Questions', 'Utilizing GenAI to Generate Targeted Interview Questions']}], 'LO': 'LO1: Manage interview in accordance to legal, ethical, socio-cultural considerations and interview objectives.', 'K_numbering_description': [{'K_number': 'K3', 'Description': 'Legal, regulatory, ethical and socio-cultural constraints related to conducting interviews'}, {'K_number': 'K4', 'Description': 'Objectives of the interviews'}], 'A_numbering_description': [{'A_number': 'A1', 'Description': 'Manage interview efforts with candidates'}], 'Assessment_Methods': ['WA-SAQ', 'RP'], 'Instructional_Methods': ['Classroom']}, {'LU_Title': 'LU2: Types and Styles of Questions for Different Interview Scenarios', 'LU_Duration': '2.5 hrs', 'Topics': [{'Topic_Title': 'Topic 2: Types and Styles of Questions for Different Interview Scenarios (K1, K5, A2)', 'Bullet_Points': ['Behavioral and Competency-Based Questions', 'Situational or Scenario-Based Questions', 'Technical and Role-Specific Questions', 'Addressing Compensation, Benefits, and Expectations', 'Leveraging GenAI to Customize Questions for Each Candidate']}], 'LO': 'LO2: Tailor structured interview questions using generative AI to various interview types.', 'K_numbering_description': [{'K_number': 'K1', 'Description': 'Types of interviews'}, {'K_number': 'K5', 'Description': 'Appropriate interview questions'}], 'A_numbering_description': [{'A_number': 'A2', 'Description': 'Deliver questions in accordance with interview structures'}], 'Assessment_Methods': ['WA-SAQ', 'RP'], 'Instructional_Methods': ['Classroom']}, {'LU_Title': 'LU3: Effective Questioning and Active Listening Techniques', 'LU_Duration': '2 hrs', 'Topics': [{'Topic_Title': 'Topic 3: Effective Questioning and Active Listening Techniques (K2, K6, A3)', 'Bullet_Points': ['Developing Active Listening Skills in Interviews', 'Handling Unexpected or Difficult Answers', 'Identifying Follow-Up Questions Based on Candidate Responses', 'Using GenAI Tools to Analyze Candidate Responses and Improve Interview Techniques', 'Evaluating Interview Outcomes and Making Informed Hiring Decisions']}], 'LO': 'LO3: Provide feedback on interview outcomes and areas for improvement.', 'K_numbering_description': [{'K_number': 'K2', 'Description': 'Interview outcomes'}, {'K_number': 'K6', 'Description': 'Effective questioning and active listening techniques that can be applied in interview situations'}], 'A_numbering_description': [{'A_number': 'A3', 'Description': 'Provide inputs to identify areas for improvement'}], 'Assessment_Methods': ['WA-SAQ', 'RP'], 'Instructional_Methods': ['Classroom']}], 'Assessment_Methods_Details': [{'Assessment_Method': 'Written Assessment - Short Answer Questions', 'Method_Abbreviation': 'WA-SAQ', 'Total_Delivery_Hours': '0.5 hr', 'Assessor_to_Candidate_Ratio': ['1:20 (Max)'], 'Evidence': [{'LO': 'LO1', 'Evidence': 'Written responses to short-answer questions.'}, {'LO': 'LO2', 'Evidence': 'Written responses to short-answer questions.'}, {'LO': 'LO3', 'Evidence': 'Written responses to short-answer questions.'}], 'Submission': ['Candidates will generate answers to the questions and submit the hardcopy to the assessor.'], 'Marking_Process': ['Assessors will evaluate the written responses on the accuracy and comprehensiveness of the answers.'], 'Retention_Period': '3 years'}, {'Assessment_Method': 'Role Play', 'Method_Abbreviation': 'RP', 'Total_Delivery_Hours': '0.5 hr', 'Assessor_to_Candidate_Ratio': ['1:1'], 'Evidence': [{'LO': 'LO1', 'Evidence': 'Understanding and aligning the interview to its purpose and objectives. Adherence to legal, ethical, and socio-cultural standards. Structuring the interview logically and effectively.'}, {'LO': 'LO2', 'Evidence': 'Crafting appropriate, targeted, and structured questions using generative AI. Adapting questions to specific interview types, such as behavioral, situational, and technical. Delivering questions professionally and clearly.'}, {'LO': 'LO3', 'Evidence': 'Active listening and insightful evaluation of candidate responses. Offering constructive and actionable feedback for improvement. Summarizing outcomes to align with the hiring objectives.'}], 'Submission': ['Assessor will evaluate the candidate using an observation checklist for the role play.'], 'Marking_Process': ['The assessor will evaluate the role play based on alignment to the learning outcomes and the following criteria:', '1) LO1: Understanding and aligning the interview to its purpose and objectives. Adherence to legal, ethical, and socio-cultural standards. Structuring the interview logically and effectively.', '2) LO2: Crafting appropriate, targeted, and structured questions using generative AI. Adapting questions to specific interview types, such as behavioral, situational, and technical. Delivering questions professionally and clearly.', '3) LO3: Active listening and insightful evaluation of candidate responses. Offering constructive and actionable feedback for improvement. Summarizing outcomes to align with the hiring objectives.', '4) Engagement and Professionalism: Demonstrating active listening, professionalism, and respect. Adapting communication styles effectively to the scenario.'], 'Retention_Period': '3 years', 'No_of_Role_Play_Scripts': '2'}], 'UEN': '201200696W', 'TGS_Ref_No': 'TGS-2024051421', 'lesson_plan': [{'Day': 'Day 1', 'Sessions': [{'Time': '0930hrs - 0935hrs (5 mins)', 'instruction_title': 'Digital Attendance and Introduction to the Course', 'bullet_points': ['Trainer Introduction', 'Learner Introduction', 'Overview of Course Structure'], 'Instructional_Methods': 'N/A', 'Resources': 'QR Attendance, Attendance Sheet'}, {'Time': '0935hrs - 1200hrs (145 mins)', 'instruction_title': 'Topic 1: Interview Preparation for HR Professionals (K3, K4, A1)', 'bullet_points': ['Understanding the Purpose and Objectives of the Interview', 'Legal, Ethical, and Socio-Cultural Considerations in Interviewing', 'Designing Effective Interview Structures', 'Preparing Appropriate and Targeted Interview Questions', 'Utilizing GenAI to Generate Targeted Interview Questions'], 'reference_line': 'Refer to some online references in Google Classroom LMS', 'Instructional_Methods': 'Classroom', 'Resources': 'Slide page 1-10, TV, Whiteboard, Wi-Fi'}, {'Time': '1200hrs - 1245hrs (45 mins)', 'instruction_title': 'Lunch Break', 'bullet_points': [], 'Instructional_Methods': 'N/A', 'Resources': 'N/A'}, {'Time': '1245hrs - 1520hrs (155 mins)', 'instruction_title': 'Topic 2: Types and Styles of Questions for Different Interview Scenarios (K1, K5, A2)', 'bullet_points': ['Behavioral and Competency-Based Questions', 'Situational or Scenario-Based Questions', 'Technical and Role-Specific Questions', 'Addressing Compensation, Benefits, and Expectations', 'Leveraging GenAI to Customize Questions for Each Candidate'], 'reference_line': 'Refer to some online references in Google Classroom LMS', 'Instructional_Methods': 'Classroom', 'Resources': 'Digital Attendance (PM), Slide page 11-20, TV, Whiteboard, Wi-Fi'}, {'Time': '1520hrs - 1525hrs (5 mins)', 'instruction_title': 'Afternoon Break', 'bullet_points': [], 'Instructional_Methods': 'N/A', 'Resources': 'N/A'}, {'Time': '1525hrs - 1725hrs (120 mins)', 'instruction_title': 'Topic 3: Effective Questioning and Active Listening Techniques (K2, K6, A3)', 'bullet_points': ['Developing Active Listening Skills in Interviews', 'Handling Unexpected or Difficult Answers', 'Identifying Follow-Up Questions Based on Candidate Responses', 'Using GenAI Tools to Analyze Candidate Responses and Improve Interview Techniques', 'Evaluating Interview Outcomes and Making Informed Hiring Decisions'], 'reference_line': 'Refer to some online references in Google Classroom LMS', 'Instructional_Methods': 'Classroom', 'Resources': 'Slide page 21-30, TV, Whiteboard, Wi-Fi'}, {'Time': '1725hrs - 1730hrs (5 mins)', 'instruction_title': 'Course Feedback and TRAQOM Survey', 'bullet_points': [], 'Instructional_Methods': 'N/A', 'Resources': 'Feedback Forms, Survey Links'}, {'Time': '1730hrs - 1800hrs (30 mins)', 'instruction_title': 'Final Assessment: Written Assessment - Short Answer Questions (WA-SAQ)', 'bullet_points': [], 'Instructional_Methods': 'Assessment', 'Resources': 'Digital Attendance (Assessment), Assessment Questions, Assessment Plan'}, {'Time': '1800hrs - 1830hrs (30 mins)', 'instruction_title': 'Final Assessment: Role Play (RP)', 'bullet_points': [], 'Instructional_Methods': 'Assessment', 'Resources': 'Digital Attendance (Assessment), Assessment Questions, Assessment Plan'}]}]}
context2 = {'Date': '29 May 2025', 'Year': 2025, 'Name_of_Organisation': 'Tertiary Infotech Pte Ltd', 'Course_Title': 'STEAM Sustainability Professional Lesson Plan Development', 'TSC_Title': 'Lesson Delivery and Classroom Management', 'TSC_Code': 'ART-LDD-3027-1.1', 'Total_Training_Hours': '14 hrs', 'Total_Assessment_Hours': '16 hrs', 'Total_Course_Duration_Hours': '30 hrs', 'Learning_Units': [{'LU_Title': 'LU1: STEAM Introduction & Lesson Plan Design', 'LU_Duration': '3 hrs', 'Topics': [{'Topic_Title': 'Topic 1: STEAM Introduction & Lesson Plan Design (K1, K4, A2)', 'Bullet_Points': ['Introducing STEAM Education', 'In-depth analysis of DDMTS model', 'Lesson plan development']}], 'LO': 'LO1: Identify appropriate learning modes and instructional methods based on learner profiles and learning needs.', 'K_numbering_description': [{'K_number': 'K1', 'Description': 'Methods of analysing outcomes of learner profile and learning needs'}, {'K_number': 'K4', 'Description': 'Types of learning modes'}], 'A_numbering_description': [{'A_number': 'A2', 'Description': 'Identify appropriate learning modes, instructional methods, and technology tools'}], 'Assessment_Methods': ['WA-SAQ', 'RP'], 'Instructional_Methods': ['Classroom', 'Peer Sharing', 'Role Play (RP)']}, {'LU_Title': 'LU2: Practical Lesson Sharing and Experience', 'LU_Duration': '4 hrs', 'Topics': [{'Topic_Title': 'Topic 2: Practical Lesson Sharing and Experience (K2, K8, A1, A3)', 'Bullet_Points': ['Demo and Practice: develop a STEAM lesson.', 'Role Play: Educators role-play as students and participate in a STEAM lesson', 'Case study Sharing: Educators to share their experience in curriculum design and implementation of the STEAM lesson']}], 'LO': 'LO2: Prepare a conducive learning environment using facilitation techniques and communication strategies.', 'K_numbering_description': [{'K_number': 'K2', 'Description': 'Techniques for preparing conducive learning venues / classrooms'}, {'K_number': 'K8', 'Description': 'Online, face-to-face, verbal and non-verbal facilitation techniques and communication techniques'}], 'A_numbering_description': [{'A_number': 'A1', 'Description': 'Prepare conducive learning environment in accordance with relevant safety and organisational requirements'}, {'A_number': 'A3', 'Description': 'Deploy facilitation, questioning and communication techniques to'}], 'Assessment_Methods': ['WA-SAQ', 'RP'], 'Instructional_Methods': ['Classroom', 'Peer Sharing', 'Role Play (RP)']}, {'LU_Title': 'LU3: DDMTS Lesson Plan Development Tutorial', 'LU_Duration': '3 hrs', 'Topics': [{'Topic_Title': 'Topic 3: DDMTS Lesson Plan Development Tutorial (K5, K6, K7, A4, A5)', 'Bullet_Points': ['Curriculum theme development: According to the design of the first lesson, the lesson plan is further improved.', 'Lesson Plan Completion: Instructors provide guidance to assist participants in completing an initial version of a DDMTS lesson plan.']}], 'LO': 'LO3: Manage group dynamics and provide targeted feedback using instructional methods and technology tools to enhance learner outcomes.', 'K_numbering_description': [{'K_number': 'K5', 'Description': 'Instructional methods'}, {'K_number': 'K6', 'Description': 'Types of learning activities, solutions and technology tools'}, {'K_number': 'K7', 'Description': 'Techniques for managing group dynamics'}], 'A_numbering_description': [{'A_number': 'A4', 'Description': 'Manage challenges and group dynamics to help learners achieve learning outcomes'}, {'A_number': 'A5', 'Description': 'Provide feedback and support to learners pertaining to learning content'}], 'Assessment_Methods': ['WA-SAQ'], 'Instructional_Methods': ['Classroom']}, {'LU_Title': 'LU4: Learning Journey Portfolio Development', 'LU_Duration': '4 hrs', 'Topics': [{'Topic_Title': 'Topic 4: Learning Journey Portfolio Development (K3, K9, A6)', 'Bullet_Points': ['Simulate the process of students uploading assignments.', 'Learn how to build and collect digital assignments.', 'Implementations & Demonstrations: Hands-on digital learning journey archive tools.']}], 'LO': 'LO4: Adjust lesson plans using classroom observations and feedback techniques to address evolving learner needs and improve lesson effectiveness.', 'K_numbering_description': [{'K_number': 'K3', 'Description': 'Methods to translate observations into improvements for classroom management'}, {'K_number': 'K9', 'Description': 'Questioning and feedback techniques'}], 'A_numbering_description': [{'A_number': 'A6', 'Description': 'Adjust lesson plans in response to learners’ progress and evolving needs'}], 'Assessment_Methods': ['WA-SAQ', 'RP'], 'Instructional_Methods': ['Classroom', 'Peer Sharing', 'Role Play (RP)']}], 'Assessment_Methods_Details': [{'Assessment_Method': 'Written Assessment - Short Answer Questions', 'Method_Abbreviation': 'WA-SAQ', 'Total_Delivery_Hours': '1 hr', 'Assessor_to_Candidate_Ratio': ['1:3 (Min)', '1:20 (Max)'], 'Evidence': [{'LO': 'LO1', 'Evidence': 'The candidate will design and structure lesson plans based on learner profiles and needs.'}, {'LO': 'LO2', 'Evidence': 'The candidate will prepare an engaging and conducive learning environment using facilitation techniques.'}, {'LO': 'LO3', 'Evidence': 'The candidate will manage group dynamics and provide constructive feedback to enhance learning.'}, {'LO': 'LO4', 'Evidence': 'The candidate will adjust lesson plans dynamically to address learner needs and improve effectiveness.'}], 'Submission': ['Candidates will generate answers to the questions and submit the hardcopy to the assessor.'], 'Marking_Process': ['Assessors will evaluate the written responses on the accuracy and comprehensiveness of the answers.'], 'Retention_Period': '3 years'}, {'Assessment_Method': 'Role Play', 'Method_Abbreviation': 'RP', 'Total_Delivery_Hours': '1 hr', 'Assessor_to_Candidate_Ratio': ['1:1'], 'Evidence': [{'LO': 'LO1', 'Evidence': 'The candidate will design and structure lesson plans based on learner profiles and needs.'}, {'LO': 'LO2', 'Evidence': 'The candidate will prepare an engaging and conducive learning environment using facilitation techniques.'}, {'LO': 'LO3', 'Evidence': 'The candidate will manage group dynamics and provide constructive feedback to enhance learning.'}, {'LO': 'LO4', 'Evidence': 'The candidate will adjust lesson plans dynamically to address learner needs and improve effectiveness.'}], 'Submission': ['Assessor will evaluate the candidate using an observation checklist for the role play.'], 'Marking_Process': ['The assessor will evaluate the role play based on alignment to the learning outcomes and the following criteria.'], 'Retention_Period': '3 years', 'No_of_Role_Play_Scripts': '2'}], 'UEN': '201200696W', 'TGS_Ref_No': 'TGS-2024051519', 'lesson_plan': [{'Day': 'Day 1', 'Sessions': [{'Time': '0930hrs - 0935hrs (5 mins)', 'instruction_title': 'Digital Attendance and Introduction to the Course', 'bullet_points': ['Trainer Introduction', 'Learner Introduction', 'Overview of Course Structure'], 'Instructional_Methods': 'N/A', 'Resources': 'QR Attendance, Attendance Sheet'}, {'Time': '0935hrs - 1040hrs (65 mins)', 'instruction_title': 'Topic 1: STEAM Introduction & Lesson Plan Design (K1, K4, A2)', 'bullet_points': ['Introducing STEAM Education', 'In-depth analysis of DDMTS model', 'Lesson plan development'], 'reference_line': 'Refer to some online references in Google Classroom LMS', 'Instructional_Methods': 'Classroom, Peer Sharing', 'Resources': 'Slide page 1-5, TV, Whiteboard, Wi-Fi'}, {'Time': '1040hrs - 1140hrs (60 mins)', 'instruction_title': 'Activity: Role Play on Lesson Plan Development', 'bullet_points': [], 'reference_line': 'Generate some roles depending on the LU', 'Instructional_Methods': 'Role Play (RP)', 'Resources': 'N/A'}, {'Time': '1140hrs - 1200hrs (20 mins)', 'instruction_title': 'Activity: Peer Sharing on Lesson Plan Development', 'bullet_points': [], 'reference_line': 'Refer to some online discussion in Google Classroom LMS', 'Instructional_Methods': 'Peer Sharing', 'Resources': 'N/A'}, {'Time': '1200hrs - 1245hrs (45 mins)', 'instruction_title': 'Lunch Break', 'bullet_points': [], 'Instructional_Methods': 'N/A', 'Resources': 'N/A'}, {'Time': '1245hrs - 1345hrs (60 mins)', 'instruction_title': 'Topic 2: Practical Lesson Sharing and Experience (K2, K8, A1, A3)', 'bullet_points': ['Demo and Practice: develop a STEAM lesson.', 'Role Play: Educators role-play as students and participate in a STEAM lesson', 'Case study Sharing: Educators to share their experience in curriculum design and implementation of the STEAM lesson'], 'reference_line': 'Refer to some online references in Google Classroom LMS', 'Instructional_Methods': 'Classroom, Peer Sharing', 'Resources': 'Digital Attendance (PM), Slide page 6-10, TV, Wi-Fi'}, {'Time': '1345hrs - 1350hrs (5 mins)', 'instruction_title': 'Afternoon Break', 'bullet_points': [], 'Instructional_Methods': 'N/A', 'Resources': 'N/A'}, {'Time': '1350hrs - 1520hrs (90 mins)', 'instruction_title': 'Activity: Role Play on STEAM Lesson Participation', 'bullet_points': [], 'reference_line': 'Generate some roles depending on the LU', 'Instructional_Methods': 'Role Play (RP)', 'Resources': 'N/A'}, {'Time': '1520hrs - 1825hrs (185 mins)', 'instruction_title': 'Activity: Case Study Sharing on STEAM Lesson Implementation', 'bullet_points': [], 'reference_line': 'Refer to some online case studies in Google Classroom LMS', 'Instructional_Methods': 'Peer Sharing', 'Resources': 'N/A'}, {'Time': '1825hrs - 1830hrs (5 mins)', 'instruction_title': 'Recap All Contents and Close', 'bullet_points': ['Summary of key learning points', 'Q&A'], 'Instructional_Methods': 'Classroom, Peer Sharing', 'Resources': 'Slide page 11, TV, Whiteboard, Wi-Fi'}]}, {'Day': 'Day 2', 'Sessions': [{'Time': '0930hrs - 0935hrs (5 mins)', 'instruction_title': 'Digital Attendance (AM)', 'bullet_points': [], 'Instructional_Methods': 'N/A', 'Resources': 'QR Attendance, Attendance Sheet'}, {'Time': '0935hrs - 1040hrs (65 mins)', 'instruction_title': 'Topic 3: DDMTS Lesson Plan Development Tutorial (K5, K6, K7, A4, A5)', 'bullet_points': ['Curriculum theme development: According to the design of the first lesson, the lesson plan is further improved.', 'Lesson Plan Completion: Instructors provide guidance to assist participants in completing an initial version of a DDMTS lesson plan.'], 'reference_line': 'Refer to some online references in Google Classroom LMS', 'Instructional_Methods': 'Classroom', 'Resources': 'Slide page 12-16, TV, Whiteboard, Wi-Fi'}, {'Time': '1040hrs - 1140hrs (60 mins)', 'instruction_title': 'Activity: Peer Sharing on DDMTS Lesson Plan Development', 'bullet_points': [], 'reference_line': 'Refer to some online discussion in Google Classroom LMS', 'Instructional_Methods': 'Peer Sharing', 'Resources': 'N/A'}, {'Time': '1140hrs - 1200hrs (20 mins)', 'instruction_title': 'Activity: Role Play on DDMTS Lesson Plan Development', 'bullet_points': [], 'reference_line': 'Generate some roles depending on the LU', 'Instructional_Methods': 'Role Play (RP)', 'Resources': 'N/A'}, {'Time': '1200hrs - 1245hrs (45 mins)', 'instruction_title': 'Lunch Break', 'bullet_points': [], 'Instructional_Methods': 'N/A', 'Resources': 'N/A'}, {'Time': '1245hrs - 1345hrs (60 mins)', 'instruction_title': 'Topic 4: Learning Journey Portfolio Development (K3, K9, A6)', 'bullet_points': ['Simulate the process of students uploading assignments.', 'Learn how to build and collect digital assignments.', 'Implementations & Demonstrations: Hands-on digital learning journey archive tools.'], 'reference_line': 'Refer to some online references in Google Classroom LMS', 'Instructional_Methods': 'Classroom, Peer Sharing', 'Resources': 'Digital Attendance (PM), Slide page 17-21, TV, Wi-Fi'}, {'Time': '1345hrs - 1350hrs (5 mins)', 'instruction_title': 'Afternoon Break', 'bullet_points': [], 'Instructional_Methods': 'N/A', 'Resources': 'N/A'}, {'Time': '1350hrs - 1520hrs (90 mins)', 'instruction_title': 'Activity: Hands-on Practice on Digital Learning Journey Archive Tools', 'bullet_points': [], 'reference_line': 'Refer to some online practices in Google Classroom LMS', 'Instructional_Methods': 'Classroom', 'Resources': 'N/A'}, {'Time': '1520hrs - 1825hrs (185 mins)', 'instruction_title': 'Activity: Peer Sharing on Learning Journey Portfolio Development', 'bullet_points': [], 'reference_line': 'Refer to some online discussion in Google Classroom LMS', 'Instructional_Methods': 'Peer Sharing', 'Resources': 'N/A'}, {'Time': '1825hrs - 1830hrs (5 mins)', 'instruction_title': 'Recap All Contents and Close', 'bullet_points': ['Summary of key learning points', 'Q&A'], 'Instructional_Methods': 'Classroom, Peer Sharing', 'Resources': 'Slide page 22, TV, Whiteboard, Wi-Fi'}]}, {'Day': 'Day 3', 'Sessions': [{'Time': '0930hrs - 0935hrs (5 mins)', 'instruction_title': 'Digital Attendance (AM)', 'bullet_points': [], 'Instructional_Methods': 'N/A', 'Resources': 'QR Attendance, Attendance Sheet'}, {'Time': '0935hrs - 1040hrs (65 mins)', 'instruction_title': 'Recap All Contents and Close', 'bullet_points': ['Summary of key learning points', 'Q&A'], 'Instructional_Methods': 'Classroom, Peer Sharing', 'Resources': 'Slide page 23, TV, Whiteboard, Wi-Fi'}, {'Time': '1040hrs - 1140hrs (60 mins)', 'instruction_title': 'Course Feedback and TRAQOM Survey', 'bullet_points': [], 'Instructional_Methods': 'N/A', 'Resources': 'Feedback Forms, Survey Links'}, {'Time': '1140hrs - 1200hrs (20 mins)', 'instruction_title': 'Final Assessment: Written Assessment - Short Answer Questions (WA-SAQ)', 'bullet_points': [], 'Instructional_Methods': 'Assessment', 'Resources': 'Digital Attendance (Assessment), Assessment Questions, Assessment Plan'}, {'Time': '1200hrs - 1245hrs (45 mins)', 'instruction_title': 'Lunch Break', 'bullet_points': [], 'Instructional_Methods': 'N/A', 'Resources': 'N/A'}, {'Time': '1245hrs - 1345hrs (60 mins)', 'instruction_title': 'Final Assessment: Role Play (RP)', 'bullet_points': [], 'Instructional_Methods': 'Assessment', 'Resources': 'Digital Attendance (Assessment), Assessment Questions, Assessment Plan'}, {'Time': '1345hrs - 1350hrs (5 mins)', 'instruction_title': 'Afternoon Break', 'bullet_points': [], 'Instructional_Methods': 'N/A', 'Resources': 'N/A'}, {'Time': '1350hrs - 1520hrs (90 mins)', 'instruction_title': 'Final Assessment: Role Play (RP) (Cont.)', 'bullet_points': [], 'Instructional_Methods': 'Assessment', 'Resources': 'Digital Attendance (Assessment), Assessment Questions, Assessment Plan'}, {'Time': '1520hrs - 1825hrs (185 mins)', 'instruction_title': 'Final Assessment: Written Assessment - Short Answer Questions (WA-SAQ) (Cont.)', 'bullet_points': [], 'Instructional_Methods': 'Assessment', 'Resources': 'Digital Attendance (Assessment), Assessment Questions, Assessment Plan'}, {'Time': '1825hrs - 1830hrs (5 mins)', 'instruction_title': 'Course Closing', 'bullet_points': [], 'Instructional_Methods': 'N/A', 'Resources': 'N/A'}]}, {'Day': 'Day 4', 'Sessions': [{'Time': '0930hrs - 0935hrs (5 mins)', 'instruction_title': 'Digital Attendance (AM)', 'bullet_points': [], 'Instructional_Methods': 'N/A', 'Resources': 'QR Attendance, Attendance Sheet'}, {'Time': '0935hrs - 1040hrs (65 mins)', 'instruction_title': 'Final Assessment: Written Assessment - Short Answer Questions (WA-SAQ) (Cont.)', 'bullet_points': [], 'Instructional_Methods': 'Assessment', 'Resources': 'Digital Attendance (Assessment), Assessment Questions, Assessment Plan'}, {'Time': '1040hrs - 1140hrs (60 mins)', 'instruction_title': 'Final Assessment: Role Play (RP) (Cont.)', 'bullet_points': [], 'Instructional_Methods': 'Assessment', 'Resources': 'Digital Attendance (Assessment), Assessment Questions, Assessment Plan'}, {'Time': '1140hrs - 1200hrs (20 mins)', 'instruction_title': 'Final Assessment: Written Assessment - Short Answer Questions (WA-SAQ) (Cont.)', 'bullet_points': [], 'Instructional_Methods': 'Assessment', 'Resources': 'Digital Attendance (Assessment), Assessment Questions, Assessment Plan'}, {'Time': '1200hrs - 1245hrs (45 mins)', 'instruction_title': 'Lunch Break', 'bullet_points': [], 'Instructional_Methods': 'N/A', 'Resources': 'N/A'}, {'Time': '1245hrs - 1345hrs (60 mins)', 'instruction_title': 'Final Assessment: Role Play (RP) (Cont.)', 'bullet_points': [], 'Instructional_Methods': 'Assessment', 'Resources': 'Digital Attendance (Assessment), Assessment Questions, Assessment Plan'}, {'Time': '1345hrs - 1350hrs (5 mins)', 'instruction_title': 'Afternoon Break', 'bullet_points': [], 'Instructional_Methods': 'N/A', 'Resources': 'N/A'}, {'Time': '1350hrs - 1520hrs (90 mins)', 'instruction_title': 'Final Assessment: Written Assessment - Short Answer Questions (WA-SAQ) (Cont.)', 'bullet_points': [], 'Instructional_Methods': 'Assessment', 'Resources': 'Digital Attendance (Assessment), Assessment Questions, Assessment Plan'}, {'Time': '1520hrs - 1825hrs (185 mins)', 'instruction_title': 'Final Assessment: Role Play (RP) (Cont.)', 'bullet_points': [], 'Instructional_Methods': 'Assessment', 'Resources': 'Digital Attendance (Assessment), Assessment Questions, Assessment Plan'}, {'Time': '1825hrs - 1830hrs (5 mins)', 'instruction_title': 'Course Closing', 'bullet_points': [], 'Instructional_Methods': 'N/A', 'Resources': 'N/A'}]}]}
context3 = {'Date': '02 Jun 2025', 'Year': 2025, 'Name_of_Organisation': 'INFO-TECH SYSTEMS INTEGRATORS PTE. LTD.', 'Course_Title': 'Master Conflict Resolution in the Workplace for Effective Leadership', 'TSC_Title': 'Conflict Management', 'TSC_Code': 'RET-PMD-4001-1.1', 'Total_Training_Hours': '14 hrs', 'Total_Assessment_Hours': '2 hrs', 'Total_Course_Duration_Hours': '16 hrs', 'Learning_Units': [{'LU_Title': 'LU1: Identify Conflicts', 'LU_Duration': '3.5 hrs', 'Topics': [{'Topic_Title': 'Topic 1: Identify Conflicts (K1, A1, A6)', 'Bullet_Points': ['Assess conflict situation', 'Causes of conflict (K1)', 'Determine ways to validate information and history of conflict (A1)', 'Identify the possible causes of conflict (A1)', 'Recognise factors and early indicators that give rise to conflicts (A6)']}], 'LO': 'LO1 - Identify early indicators of conflicts to minimize impact', 'K_numbering_description': [{'K_number': 'K1', 'Description': 'Signs, stages and causes of conflicts'}], 'A_numbering_description': [{'A_number': 'A1', 'Description': 'Identify and resolve conflicts and minimise impact on other colleagues and customers'}, {'A_number': 'A6', 'Description': 'Recognise early indicators of conflicts'}], 'Assessment_Methods': ['WA-SAQ', 'CS'], 'Instructional_Methods': ['Lecture', 'Peer Sharing', 'Group Discussion', 'Case Study']}, {'LU_Title': 'LU2: Conflict Resolution Strategies', 'LU_Duration': '3.5 hrs', 'Topics': [{'Topic_Title': 'Topic 2: Conflict Resolution Strategies (K2, K5, A4, A8)', 'Bullet_Points': ['Resolution strategies to resolve conflicts', 'Analyse and decide on the best resolutions', 'Communication and negotiation skills for managing team conflicts', 'Conflict resolution process and deal with conflicts sensitively']}], 'LO': 'LO2 - Resolve the conflicts after deciding the best conflict resolution strategies, and deal with conflicts sensitively.', 'K_numbering_description': [{'K_number': 'K2', 'Description': 'Conflict resolution techniques'}, {'K_number': 'K5', 'Description': 'Facilitation, communication and negotiation methods for managing conflicts'}], 'A_numbering_description': [{'A_number': 'A4', 'Description': 'Deal with conflicts sensitively, courteously and discreetly through use of conflict resolution techniques'}, {'A_number': 'A8', 'Description': 'Analyse and decide on the best resolutions for conflict initiative and enterprise skills to consider and suggest changes to workplace practices to avoid future conflicts'}], 'Assessment_Methods': ['WA-SAQ', 'CS'], 'Instructional_Methods': ['Lecture', 'Peer Sharing', 'Group Discussion', 'Case Study']}, {'LU_Title': 'LU3: Managing Team Conflicts in Workplace', 'LU_Duration': '3.5 hrs', 'Topics': [{'Topic_Title': 'Topic 3: Managing Team Conflicts in Workplace (K4, K6, A5, A7, A9)', 'Bullet_Points': ['Scope of responsibilities to manage team conflicts', 'Possible benefits of team conflict', 'Resolving team conflict', 'Organisational policies and procedures to manage conflicts', 'Coaching team members to resolve conflict']}], 'LO': 'LO3 - Analyze team conflicts in the work place and resolve conflicts through coaching team members', 'K_numbering_description': [{'K_number': 'K4', 'Description': 'Organisational policies and procedures which provide clarification or assistance in relation to the management of conflicts'}, {'K_number': 'K6', 'Description': 'Scope of responsibilities as the manager of a department or cross functional team, in leading and managing several work teams or projects'}], 'A_numbering_description': [{'A_number': 'A5', 'Description': 'Take responsibility for conflict outcomes'}, {'A_number': 'A7', 'Description': 'Discuss and resolve conflicts between team members'}, {'A_number': 'A9', 'Description': 'Coach team members to resolve conflicts and assess conflict situations to enable selection of the most appropriate resolution approach'}], 'Assessment_Methods': ['WA-SAQ', 'CS'], 'Instructional_Methods': ['Lecture', 'Peer Sharing', 'Group Discussion', 'Case Study']}, {'LU_Title': 'LU4: Reviewing the Effectiveness of Conflict Resolution and Preventing Conflict Recurrence', 'LU_Duration': '3.5 hrs', 'Topics': [{'Topic_Title': 'Topic 4: Reviewing the Effectiveness of Conflict Resolution and Preventing Conflict Recurrence (K3, A2, A3)', 'Bullet_Points': ['Review the effectiveness various conflict resolution strategies', 'Actions to revent conflict recurrence', 'Legal and ethical considerations relating to conflict management']}], 'LO': 'LO4 – Review the effectiveness of conflict resolution and take actions to prevent the recurrence of conflicts.', 'K_numbering_description': [{'K_number': 'K3', 'Description': 'Legal and ethical considerations relating to conflict management'}], 'A_numbering_description': [{'A_number': 'A2', 'Description': 'Review the effectiveness of the conflict resolution strategies'}, {'A_number': 'A3', 'Description': 'Take action to prevent the recurrence of conflicts'}], 'Assessment_Methods': ['WA-SAQ', 'CS'], 'Instructional_Methods': ['Lecture', 'Peer Sharing', 'Group Discussion', 'Case Study']}], 'Assessment_Methods_Details': [{'Assessment_Method': 'Written Assessment - Short Answer Questions', 'Method_Abbreviation': 'WA-SAQ', 'Total_Delivery_Hours': '1 hr', 'Assessor_to_Candidate_Ratio': ['1:3 (Min)', '1:20 (Max)'], 'Evidence': None, 'Submission': None, 'Marking_Process': None, 'Retention_Period': None}, {'Assessment_Method': 'Case Study', 'Method_Abbreviation': 'CS', 'Total_Delivery_Hours': '1 hr', 'Assessor_to_Candidate_Ratio': ['1:3 (Min)', '1:20 (Max)'], 'Evidence': None, 'Submission': None, 'Marking_Process': None, 'Retention_Period': None}], 'UEN': '201200696W', 'TGS_Ref_No': 'TGS-2025055382', 'lesson_plan': [{'Day': 'Day 1', 'Sessions': [{'Time': '0930hrs - 0935hrs (5 mins)', 'instruction_title': 'Digital Attendance and Introduction to the Course', 'bullet_points': ['Trainer Introduction', 'Learner Introduction', 'Overview of Course Structure'], 'Instructional_Methods': 'N/A', 'Resources': 'QR Attendance, Attendance Sheet'}, {'Time': '0935hrs - 1040hrs (105 mins)', 'instruction_title': 'Topic 1: Identify Conflicts (K1, A1, A6)', 'bullet_points': ['Assess conflict situation', 'Causes of conflict (K1)', 'Determine ways to validate information and history of conflict (A1)'], 'reference_line': 'Refer to some online references in Google Classroom LMS', 'Instructional_Methods': 'Lecture, Group Discussion', 'Resources': 'Slide page 1-5, TV, Whiteboard, Wi-Fi'}, {'Time': '1040hrs - 1140hrs (60 mins)', 'instruction_title': 'Activity: Peer Sharing on Conflict Identification', 'bullet_points': [], 'reference_line': 'Refer to some online discussion in Google Classroom LMS', 'Instructional_Methods': 'Peer Sharing, Group Discussion', 'Resources': 'N/A'}, {'Time': '1140hrs - 1200hrs (20 mins)', 'instruction_title': 'Topic 1: Identify Conflicts (K1, A1, A6) (Cont.)', 'bullet_points': ['Identify the possible causes of conflict (A1)', 'Recognise factors and early indicators that give rise to conflicts (A6)'], 'reference_line': 'Refer to some online references in Google Classroom LMS', 'Instructional_Methods': 'Lecture, Group Discussion', 'Resources': 'Slide page 6-10, TV, Whiteboard, Wi-Fi'}, {'Time': '1200hrs - 1245hrs (45 mins)', 'instruction_title': 'Lunch Break', 'bullet_points': [], 'Instructional_Methods': 'N/A', 'Resources': 'N/A'}, {'Time': '1245hrs - 1345hrs (60 mins)', 'instruction_title': 'Topic 2: Conflict Resolution Strategies (K2, K5, A4, A8)', 'bullet_points': ['Resolution strategies to resolve conflicts', 'Analyse and decide on the best resolutions'], 'reference_line': 'Refer to some online references in Google Classroom LMS', 'Instructional_Methods': 'Lecture, Group Discussion', 'Resources': 'Digital Attendance (PM), Slide page 11-15, TV, Whiteboard, Wi-Fi'}, {'Time': '1345hrs - 1350hrs (5 mins)', 'instruction_title': 'Afternoon Break', 'bullet_points': [], 'Instructional_Methods': 'N/A', 'Resources': 'N/A'}, {'Time': '1350hrs - 1450hrs (60 mins)', 'instruction_title': 'Activity: Case Study on Conflict Resolution', 'bullet_points': [], 'reference_line': 'Refer to some online case studies in Google Classroom LMS', 'Instructional_Methods': 'Case Study', 'Resources': 'N/A'}, {'Time': '1450hrs - 1520hrs (30 mins)', 'instruction_title': 'Topic 2: Conflict Resolution Strategies (K2, K5, A4, A8) (Cont.)', 'bullet_points': ['Communication and negotiation skills for managing team conflicts', 'Conflict resolution process and deal with conflicts sensitively'], 'reference_line': 'Refer to some online references in Google Classroom LMS', 'Instructional_Methods': 'Lecture, Group Discussion', 'Resources': 'Slide page 16-20, TV, Whiteboard, Wi-Fi'}, {'Time': '1520hrs - 1620hrs (60 mins)', 'instruction_title': 'Topic 3: Managing Team Conflicts in Workplace (K4, K6, A5, A7, A9)', 'bullet_points': ['Scope of responsibilities to manage team conflicts', 'Possible benefits of team conflict'], 'reference_line': 'Refer to some online references in Google Classroom LMS', 'Instructional_Methods': 'Lecture, Group Discussion', 'Resources': 'Slide page 21-25, TV, Whiteboard, Wi-Fi'}, {'Time': '1620hrs - 1720hrs (60 mins)', 'instruction_title': 'Activity: Group Discussion on Team Conflict Management', 'bullet_points': [], 'reference_line': 'Refer to some online discussion in Google Classroom LMS', 'Instructional_Methods': 'Group Discussion', 'Resources': 'N/A'}, {'Time': '1720hrs - 1825hrs (65 mins)', 'instruction_title': 'Topic 3: Managing Team Conflicts in Workplace (K4, K6, A5, A7, A9) (Cont.)', 'bullet_points': ['Resolving team conflict', 'Organisational policies and procedures to manage conflicts', 'Coaching team members to resolve conflict'], 'reference_line': 'Refer to some online references in Google Classroom LMS', 'Instructional_Methods': 'Lecture, Group Discussion', 'Resources': 'Slide page 26-30, TV, Whiteboard, Wi-Fi'}, {'Time': '1825hrs - 1830hrs (5 mins)', 'instruction_title': 'Recap All Contents and Close', 'bullet_points': ['Summary of key learning points', 'Q&A'], 'Instructional_Methods': 'Lecture, Group Discussion', 'Resources': 'Slide page 31, TV, Whiteboard, Wi-Fi'}]}, {'Day': 'Day 2', 'Sessions': [{'Time': '0930hrs - 0935hrs (5 mins)', 'instruction_title': 'Digital Attendance (AM)', 'bullet_points': [], 'Instructional_Methods': 'N/A', 'Resources': 'QR Attendance, Attendance Sheet'}, {'Time': '0935hrs - 1035hrs (60 mins)', 'instruction_title': 'Topic 4: Reviewing the Effectiveness of Conflict Resolution and Preventing Conflict Recurrence (K3, A2, A3)', 'bullet_points': ['Review the effectiveness various conflict resolution strategies', 'Actions to prevent conflict recurrence'], 'reference_line': 'Refer to some online references in Google Classroom LMS', 'Instructional_Methods': 'Lecture, Group Discussion', 'Resources': 'Slide page 32-36, TV, Whiteboard, Wi-Fi'}, {'Time': '1035hrs - 1135hrs (60 mins)', 'instruction_title': 'Activity: Case Study on Conflict Resolution Review', 'bullet_points': [], 'reference_line': 'Refer to some online case studies in Google Classroom LMS', 'Instructional_Methods': 'Case Study', 'Resources': 'N/A'}, {'Time': '1135hrs - 1200hrs (25 mins)', 'instruction_title': 'Topic 4: Reviewing the Effectiveness of Conflict Resolution and Preventing Conflict Recurrence (K3, A2, A3) (Cont.)', 'bullet_points': ['Legal and ethical considerations relating to conflict management'], 'reference_line': 'Refer to some online references in Google Classroom LMS', 'Instructional_Methods': 'Lecture, Group Discussion', 'Resources': 'Slide page 37-40, TV, Whiteboard, Wi-Fi'}, {'Time': '1200hrs - 1245hrs (45 mins)', 'instruction_title': 'Lunch Break', 'bullet_points': [], 'Instructional_Methods': 'N/A', 'Resources': 'N/A'}, {'Time': '1245hrs - 1345hrs (60 mins)', 'instruction_title': 'Recap All Contents and Close', 'bullet_points': ['Summary of key learning points', 'Q&A'], 'reference_line': 'Refer to some online references in Google Classroom LMS', 'Instructional_Methods': 'Lecture, Group Discussion', 'Resources': 'Digital Attendance (PM), Slide page 41, TV, Whiteboard, Wi-Fi'}, {'Time': '1345hrs - 1350hrs (5 mins)', 'instruction_title': 'Afternoon Break', 'bullet_points': [], 'Instructional_Methods': 'N/A', 'Resources': 'N/A'}, {'Time': '1350hrs - 1425hrs (35 mins)', 'instruction_title': 'Course Feedback and TRAQOM Survey', 'bullet_points': [], 'Instructional_Methods': 'N/A', 'Resources': 'Feedback Forms, Survey Links'}, {'Time': '1425hrs - 1525hrs (60 mins)', 'instruction_title': 'Final Assessment: Written Assessment - Short Answer Questions (WA-SAQ)', 'bullet_points': [], 'Instructional_Methods': 'Assessment', 'Resources': 'Digital Attendance (Assessment), Assessment Questions, Assessment Plan'}, {'Time': '1525hrs - 1625hrs (60 mins)', 'instruction_title': 'Final Assessment: Case Study (CS)', 'bullet_points': [], 'Instructional_Methods': 'Assessment', 'Resources': 'Digital Attendance (Assessment), Assessment Questions, Assessment Plan'}]}]}
import re
import json
from collections import deque
import copy
from datetime import datetime, timedelta

def round_to_nearest_5(duration, round_type='down'):
    """
    Round duration (in minutes) to the nearest multiple of 5.
    
    Args:
        duration: Duration in minutes
        round_type: 'down' or 'up' to specify rounding direction
        
    Returns:
        (rounded_duration, leftover_minutes)
    """
    if round_type == 'down':
        rounded = (duration // 5) * 5
        leftover = duration - rounded
    else:  # round up
        rounded = ((duration + 4) // 5) * 5
        leftover = rounded - duration
    
    return rounded, leftover


def parse_duration(duration_str):
    """Convert 'hr' or 'min' duration strings to minutes."""
    if 'hr' in duration_str:
        hours = float(duration_str.split()[0])
        return int(hours * 60)
    elif 'min' in duration_str:
        return int(duration_str.split()[0])
    return 0

def parse_time(time_str):
    """Extract time from string like '0935hrs'."""
    clean_time = re.sub(r'\s*\(.*?\)', '', time_str)
    start_time_str = clean_time.split('-')[0].strip().replace('hrs', '').strip()
    return datetime.strptime(start_time_str, '%H%M')

def format_time(dt):
    """Format datetime object to 'HHMMhrs'."""
    return dt.strftime('%H%M') + 'hrs'

def schedule_block(day_schedule, session_queue, start_time, end_time):
    """Schedule sessions within the available time block."""
    current_time = start_time
    while current_time < end_time and session_queue:
        session = session_queue[0]
        remaining_time = (end_time - current_time).total_seconds() // 60
        # Round the duration to multiple of 5 (down)
        rounded_duration, leftover = round_to_nearest_5(session['duration'], 'down')
       
        if rounded_duration <= remaining_time:
            session = session_queue.popleft()
           
            # If there's leftover time, create a mini-session for it
            if leftover > 0:
                leftover_session = copy.deepcopy(session)
                leftover_session['duration'] = leftover
                session_queue.appendleft(leftover_session)
           
            # Use the rounded duration for scheduling
            session['duration'] = rounded_duration
            end_session = current_time + timedelta(minutes=rounded_duration)
            
            # Create session entry with original bullets
            session_to_add = session
            
        else:
            # If we can't fit the whole rounded duration
            deliver_mins = int(remaining_time)
            # Round down to nearest 5
            rounded_deliver, leftover_deliver = round_to_nearest_5(deliver_mins, 'down')
            end_session = current_time + timedelta(minutes=rounded_deliver)
            
            # Split the session and adjust bullets permanently
            partial_bullets = session['bullets'][:len(session['bullets']) // 2] if session['bullets'] else []
            
            # Create the session to add BEFORE modifying the original session
            session_to_add = {
                'title': session['title'],
                'duration': rounded_deliver,
                'bullets': partial_bullets,
                'Instructional_Methods': session['Instructional_Methods'],
                'Resources': session['Resources'],
                'reference_line': session.get('reference_line', '')
            }
            
            # Now modify the original session for the remaining part
            session['bullets'] = session['bullets'][len(partial_bullets):]  # remove delivered bullets from original
            session['duration'] -= rounded_deliver
           
            # If there's leftover time, add it to the remaining session
            if leftover_deliver > 0:
                session['duration'] += leftover_deliver
        
        # Create session entry using session_to_add
        session_entry = {
            'Time': f"{format_time(current_time)} - {format_time(end_session)} ({int((end_session - current_time).total_seconds() // 60)} mins)",
            'instruction_title': session_to_add['title'],
            'bullet_points': session_to_add['bullets'],
            'Instructional_Methods': session_to_add['Instructional_Methods'],
            'Resources': session_to_add['Resources'],
            'reference_line': session_to_add.get('reference_line', '')
        }
        day_schedule['Sessions'].append(session_entry)
        current_time = end_session
    return current_time




def fix_lesson_plan_compat(input_data):
    """
    Compatibility wrapper for fix_lesson_plan function.
    
    Args:
        input_data: Either a dictionary containing context data or JSON string
        
    Returns:
        Processed lesson plan data
    """
    # If input is already a dictionary, pass it directly
    if isinstance(input_data, dict):
        return fix_lesson_plan(input_data)
    
    # If input is a string, let the original function handle it
    elif isinstance(input_data, str):
        return fix_lesson_plan(input_data)
    
    # If it's something else, try to convert to dictionary first
    else:
        try:
            dict_data = dict(input_data)
            return fix_lesson_plan(dict_data)
        except (TypeError, ValueError):
            raise TypeError(f"Cannot convert input of type {type(input_data)} to dictionary")

def fix_lesson_plan(json_input):
    context = json.loads(json_input) if isinstance(json_input, str) else json_input
    session_reference_map = {}

    for day in context.get('lesson_plan', []):
        for session in day.get('Sessions', []):
            title = session.get('instruction_title', '').strip()
            if not title:
                continue
            session_reference_map[title] = {
                'reference_line': session.get('reference_line', 'Refer to some online references in Google Classroom LMS'),
                'Instructional_Methods': session.get('Instructional_Methods', 'Lecture'),
                'Resources': session.get('Resources', 'Slide pages, TV, Whiteboard, Wi-Fi')
            }

    for lu in context['Learning_Units']:
        lu['duration_mins'] = parse_duration(lu['LU_Duration'])

    session_queue = deque()

    for lu in context['Learning_Units']:
        total_lu_duration = lu['duration_mins']
        
        # Round the total LU duration to multiple of 5
        topic_total_duration, leftover = round_to_nearest_5(int(total_lu_duration * 0.85), 'down')
        activity_duration = total_lu_duration - topic_total_duration
        
        # Ensure activity duration is also a multiple of 5
        activity_duration, activity_leftover = round_to_nearest_5(activity_duration, 'down')
        
        # Add any leftover minutes back to topic duration if needed
        if activity_leftover > 0:
            topic_total_duration += activity_leftover
            
        topic_duration = topic_total_duration // len(lu['Topics'])

        for topic in lu['Topics']:
            topic_title = topic['Topic_Title']
            matching_session = next(
                (session_reference_map[s]
                for s in session_reference_map
                if topic_title.lower() in s.lower()),
                {
                    'reference_line': 'Refer to some online references in Google Classroom LMS',
                    'Instructional_Methods': 'Lecture, Didactic Questioning',
                    'Resources': 'Slide pages, TV, Whiteboard, Wi-Fi'
                }
            )

            session_queue.append({
                'type': 'topic',
                'title': topic_title,
                'duration': topic_duration,
                'bullets': topic['Bullet_Points'],
                'Instructional_Methods': matching_session['Instructional_Methods'],
                'Resources': matching_session['Resources'],
                'reference_line': matching_session['reference_line']
            })

        activity_title = f"Activity:"
        matching_activity = next(
            (session_reference_map[s]
            for s in session_reference_map
            if activity_title.lower() in s.lower()),
            {
                'reference_line': 'Refer to some online practices in Google Classroom LMS',
                'Instructional_Methods': 'Demonstration, Practical Performance Practice',
                'Resources': 'Slide pages, TV, Wi-Fi'
            }
        )
        activity_title = f"Activity: {lu['LU_Title']}"

        session_queue.append({
            'type': 'activity',
            'title': activity_title,
            'duration': activity_duration,
            'bullets': [],
            'Instructional_Methods': matching_activity['Instructional_Methods'],
            'Resources': matching_activity['Resources'],
            'reference_line': matching_activity['reference_line']
        })

    days = []
    current_date = datetime.strptime(context['Date'], '%d %b %Y')
    day_count = 1

    while session_queue or (not days and not session_queue):
        day_schedule = {'Day': f"Day {day_count}", 'Sessions': []}
        is_first_day = (day_count == 1)
        day_count += 1

        if is_first_day:
            day_schedule['Sessions'].append({
                'Time': '0930hrs - 0945hrs (15 mins)',
                'instruction_title': 'Digital Attendance and Introduction to the Course',
                'bullet_points': ['Trainer Introduction', 'Learner Introduction', 'Overview of Course Structure'],
                'Instructional_Methods': 'N/A',
                'Resources': 'QR Attendance, Attendance Sheet',
                'reference_line': ''
            })
            morning_start = parse_time('0945')
        else:
            day_schedule['Sessions'].append({
                'Time': '0930hrs - 0940hrs (10 mins)',
                'instruction_title': 'Digital Attendance (AM)',
                'bullet_points': [],
                'Instructional_Methods': 'N/A',
                'Resources': 'QR Attendance, Attendance Sheet',
                'reference_line': ''
            })
            morning_start = parse_time('0940')

        # Schedule morning block with 5-minute rounding
        current_time = schedule_block(day_schedule, session_queue, morning_start, parse_time('1200'))

        # Add lunch break
        day_schedule['Sessions'].append({
            'Time': '1200hrs - 1245hrs (45 mins)',
            'instruction_title': 'Lunch Break',
            'bullet_points': [],
            'Instructional_Methods': 'N/A',
            'Resources': 'N/A',
            'reference_line': ''
        })

        # Schedule afternoon block
        post_lunch_start = parse_time('1245')
        post_lunch_end = parse_time('1825')
        current_time = post_lunch_start
        tea_break_inserted = False
        post_lunch_session_count = 0

        while current_time < post_lunch_end and session_queue:
            session = session_queue[0]
            remaining_time = (post_lunch_end - current_time).total_seconds() // 60

            duration_to_use = session['duration']
            deduct_5_min = False

            # Insert tea break after first afternoon session if it's long enough
            if not tea_break_inserted and post_lunch_session_count >= 1 and session['duration'] > 5:
                deduct_5_min = True
                duration_to_use -= 5
            
            # Round duration to multiple of 5
            rounded_duration, leftover = round_to_nearest_5(duration_to_use, 'down')
            
            if rounded_duration <= remaining_time:
                session = session_queue.popleft()
                
                # If there's leftover time, create a mini-session for it
                if leftover > 0:
                    leftover_session = copy.deepcopy(session)
                    leftover_session['duration'] = leftover
                    session_queue.appendleft(leftover_session)
                
                # Use the rounded duration
                session_duration = rounded_duration
                end_session = current_time + timedelta(minutes=session_duration)
            else:
                # If we can't fit the whole rounded duration
                deliver_mins = int(remaining_time)
                # Round down to nearest 5
                rounded_deliver, leftover_deliver = round_to_nearest_5(deliver_mins, 'down')
                end_session = current_time + timedelta(minutes=rounded_deliver)
                
                # Split the session
                partial_session = copy.deepcopy(session)
                partial_session['duration'] = rounded_deliver
                
                # Split bullets if any
                if session['bullets']:
                    bullet_count = len(session['bullets'])
                    partial_bullets_count = max(1, int(bullet_count * rounded_deliver / session['duration']))
                    partial_session['bullets'] = session['bullets'][:partial_bullets_count]
                    session['bullets'] = session['bullets'][partial_bullets_count:]
                
                # Adjust original session duration
                session['duration'] -= rounded_deliver
                
                # Use partial session for scheduling
                session_duration = rounded_deliver

            day_schedule['Sessions'].append({
                'Time': f"{format_time(current_time)} - {format_time(end_session)} ({session_duration} mins)",
                'instruction_title': session['title'] if 'title' in locals() else partial_session['title'],
                'bullet_points': session['bullets'] if 'title' in locals() else partial_session['bullets'],
                'Instructional_Methods': session['Instructional_Methods'] if 'title' in locals() else partial_session['Instructional_Methods'],
                'Resources': session['Resources'] if 'title' in locals() else partial_session['Resources'],
                'reference_line': session.get('reference_line', '') if 'title' in locals() else partial_session.get('reference_line', '')
            })

            current_time = end_session
            post_lunch_session_count += 1

            # Insert tea break if needed
            if deduct_5_min:
                tea_break_end = current_time + timedelta(minutes=5)
                day_schedule['Sessions'].append({
                    'Time': f"{format_time(current_time)} - {format_time(tea_break_end)} (5 mins)",
                    'instruction_title': 'Tea Break',
                    'bullet_points': [],
                    'Instructional_Methods': 'N/A',
                    'Resources': 'Refreshments',
                    'reference_line': ''
                })
                current_time = tea_break_end
                tea_break_inserted = True

        is_last_lu_day = not session_queue

        if not is_last_lu_day:
            # Add recap for regular days
            day_schedule['Sessions'].append({
                'Time': '1825hrs - 1830hrs (5 mins)',
                'instruction_title': 'Recap All Contents and Close',
                'bullet_points': ['Summary of key learning points', 'Q&A'],
                'Instructional_Methods': 'Classroom Didactic Questioning, Practical Performance (PP)',
                'Resources': 'Slide pages, TV, Whiteboard, Wi-Fi',
                'reference_line': ''
            })
        else:
            # Handle last day - add TRAQOM and assessments
            
            # Deduct 5 mins from final LU session for TRAQOM
            last_session = None
            for session in reversed(day_schedule['Sessions']):
                if "instruction_title" in session and "Recap" not in session["instruction_title"] and "Break" not in session["instruction_title"]:
                    last_session = session
                    break

            if last_session:
                time_range = last_session['Time']
                match = re.match(r'(\d{4})hrs - (\d{4})hrs \((\d+)\s+mins\)', time_range)
                if match:
                    start_str, end_str, duration_str = match.groups()
                    new_end = parse_time(end_str) - timedelta(minutes=5)
                    new_duration = int(duration_str) - 5
                    last_session['Time'] = f"{start_str}hrs - {format_time(new_end)} ({new_duration} mins)"

                    # Insert TRAQOM
                    tea_break_end = new_end + timedelta(minutes=5)
                    day_schedule['Sessions'].append({
                        'Time': f"{format_time(new_end)} - {format_time(tea_break_end)} (5 mins)",
                        'instruction_title': 'Course Feedback and TRAQOM Survey',
                        'bullet_points': [],
                        'Instructional_Methods': 'N/A',
                        'Resources': 'Feedback Forms, Survey Links',
                        'reference_line': ''
                    })
                    current_time = tea_break_end

            # Schedule assessments in available time
            total_assessment_time = sum(parse_duration(method['Total_Delivery_Hours']) for method in context['Assessment_Methods_Details'])
            available_time = (parse_time('1830') - current_time).total_seconds() / 60
            time_ratio = min(1, available_time / total_assessment_time) if total_assessment_time > 0 else 1

            for method in context['Assessment_Methods_Details']:
                duration = parse_duration(method['Total_Delivery_Hours']) * time_ratio
                if current_time >= parse_time('1830'):
                    break
                    
                # Round assessment duration to multiple of 5
                rounded_duration, leftover = round_to_nearest_5(duration, 'down')
                end_time = min(current_time + timedelta(minutes=rounded_duration), parse_time('1830'))
                session_duration = int((end_time - current_time).total_seconds() / 60)
                
                day_schedule['Sessions'].append({
                    'Time': f"{format_time(current_time)} - {format_time(end_time)} ({session_duration} mins)",
                    'instruction_title': "Final Assessment: " + method['Assessment_Method'],
                    'bullet_points': [],
                    'Instructional_Methods': 'Assessment',
                    'Resources': 'Assessment Plan',
                    'reference_line': ''
                })
                current_time = end_time

            # Adjust final session if needed
            if current_time < parse_time('1830') and day_schedule['Sessions']:
                last_session = day_schedule['Sessions'][-1]
                start_str = last_session['Time'].split(' - ')[0]
                start_time = parse_time(start_str.replace('hrs', ''))
                duration_mins = int((parse_time('1830') - start_time).total_seconds() / 60)
                last_session['Time'] = f"{format_time(start_time)} - 1830hrs ({duration_mins} mins)"

        days.append(day_schedule)
        current_date += timedelta(days=1)

    return {'lesson_plan': days}

def parse_time_range(time_str):
    """
    Parse a string like '0930hrs - 0935hrs (5 mins)' into:
    - start time (as '0930'),
    - end time (as '0935'),
    - duration (as 'Xh Ymin' formatted string).
    """
    match = re.match(r'(\d{4})hrs\s*-\s*(\d{4})hrs\s*\((\d+)\s+mins\)', time_str)
    if not match:
        return None, None, None

    start_str, end_str, duration_str = match.groups()
    starttime = start_str
    endtime = end_str
    duration_mins = int(duration_str)
    hours = duration_mins // 60
    minutes = duration_mins % 60

    if hours and minutes:
        duration_formatted = f"{hours}h {minutes}min"
    elif hours:
        duration_formatted = f"{hours}h"
    else:
        duration_formatted = f"{minutes}min"

    return starttime, endtime, duration_formatted

def addstartendduration(data):
    for day in data['lesson_plan']:
        for session in day['Sessions']:
            start, end, duration = parse_time_range(session['Time'])
            session['starttime'] = start
            session['endtime'] = end
            session['duration'] = duration
            del session['Time']  # Remove original Time field
    return data

def renameactivity(lesson_plan_data):
    # Create a mapping of Learning Unit numbers to their instructional methods
    lu_instructional_methods = {}
    
    # Extract instructional methods from Learning Units
    for lu in lesson_plan_data.get('Learning_Units', []):
        lu_title = lu.get('LU_Title', '')
        # Extract LU number (e.g., "LU1" from "LU1: Identify Conflicts")
        lu_match = re.match(r'LU(\d+):', lu_title)
        if lu_match:
            lu_number = lu_match.group(1)
            # Get instructional methods and join them with ", "
            methods = lu.get('Instructional_Methods', [])
            if isinstance(methods, list):
                lu_instructional_methods[lu_number] = ", ".join(methods)
            else:
                lu_instructional_methods[lu_number] = methods
    
    # Process each day and session
    for day in lesson_plan_data['lesson_plan']:
        for session in day['Sessions']:
            title = session.get('instruction_title', '')
            
            # Check if the title starts with 'Activity: LUx:'
            match = re.match(r'(Activity: )LU(\d+):(.*)', title)
            if match:
                prefix, lu_number, rest = match.groups()
                
                # Get instructional methods from the corresponding Learning Unit
                instr_methods = lu_instructional_methods.get(lu_number, '')
                
                # If we have valid instructional methods, use them
                if instr_methods and instr_methods.upper() != 'N/A':
                    # Replace LUx with Instructional Methods + " on"
                    new_title = f"{prefix}{instr_methods} on{rest}"
                else:
                    # If no valid Instructional Methods, just remove LUx: and keep the rest
                    new_title = f"{prefix}{rest}"
                
                session['instruction_title'] = new_title.strip()
    
    return lesson_plan_data

def postprocess_resources(lesson_plan_data):
    found_pm_attendance = False
    found_assessment_attendance = False

    for day in lesson_plan_data['lesson_plan']:
        sessions = day['Sessions']
        for i, session in enumerate(sessions):
            title = session['instruction_title']
            resources = session.get('Resources', '')

            # Rule 1: Digital Attendance (PM)
            if title.lower() == 'lunch break':
                # Check next session
                if i + 1 < len(sessions):
                    next_session = sessions[i + 1]
                    next_resources = next_session.get('Resources', '')
                    if "Digital Attendance (PM)" not in next_resources:
                        # Add only here
                        next_session['Resources'] = "Digital Attendance (PM), " + next_resources if next_resources else "Digital Attendance (PM)"
                    found_pm_attendance = True
                continue  # Skip lunch block

            # Remove Digital Attendance (PM) if it's elsewhere
            if "Digital Attendance (PM)" in resources and not (
                found_pm_attendance and i > 0 and sessions[i - 1]['instruction_title'].lower() == 'lunch break'
            ):
                session['Resources'] = ", ".join(
                    [res.strip() for res in resources.split(",") if res.strip() != "Digital Attendance (PM)"]
                )

            # Rule 2: Digital Attendance Assessment
            is_final_assessment = title.strip().lower().startswith("final assessment")
            if "Digital Attendance Assessment" in resources:
                if not found_assessment_attendance and is_final_assessment:
                    found_assessment_attendance = True
                else:
                    # Remove from any subsequent assessments
                    session['Resources'] = ", ".join(
                        [res.strip() for res in resources.split(",") if res.strip() != "Digital Attendance Assessment"]
                    )

            # Add Digital Attendance Assessment to the first final assessment if not yet found
            if is_final_assessment and not found_assessment_attendance:
                if "Digital Attendance Assessment" not in resources:
                    session['Resources'] = "Digital Attendance Assessment, " + resources if resources else "Digital Attendance Assessment"
                found_assessment_attendance = True

    return lesson_plan_data

def remove_brackets_from_titles(lesson_plan_data):
    # Pattern to remove brackets and their content (round, square, curly)
    pattern = re.compile(r'\s*[\(\[\{][^\)\]\}]*[\)\]\}]')
    
    for day in lesson_plan_data.get("lesson_plan", []):
        for session in day.get("Sessions", []):
            original_title = session.get("instruction_title", "")
            # Remove brackets and contents
            cleaned_title = pattern.sub("", original_title).strip()
            session["instruction_title"] = cleaned_title
    
    return lesson_plan_data

temptimetable = fix_lesson_plan_compat(context3)
temptimetable = addstartendduration(temptimetable)
temptimetable = renameactivity(temptimetable)
temptimetable = postprocess_resources(temptimetable)
temptimetable = remove_brackets_from_titles(temptimetable)
# Print the transformed timetable
print(json.dumps(temptimetable, indent=4))